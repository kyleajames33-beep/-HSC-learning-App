<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Learning Analytics Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #2d3748;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            color: #718096;
            font-size: 1.1rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        .card h2 {
            color: #2d3748;
            font-size: 1.5rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-icon {
            font-size: 1.8rem;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100px;
            color: #718096;
        }

        .spinner {
            border: 2px solid #e2e8f0;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .insight-item {
            background: #f7fafc;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
        }

        .insight-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .insight-description {
            color: #718096;
            font-size: 0.9rem;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #4a5568;
            font-weight: 500;
        }

        .metric-value {
            color: #2d3748;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 0.8s ease;
        }

        .recommendation {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .recommendation.high {
            border-color: #fc8181;
            background: #fff5f5;
        }

        .recommendation.medium {
            border-color: #f6ad55;
            background: #fffaf0;
        }

        .recommendation.low {
            border-color: #68d391;
            background: #f0fff4;
        }

        .recommendation-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .recommendation-description {
            color: #4a5568;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .recommendation-actions {
            font-size: 0.85rem;
            color: #718096;
        }

        .priority-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-high {
            background: #fed7d7;
            color: #c53030;
        }

        .priority-medium {
            background: #feebc8;
            color: #dd6b20;
        }

        .priority-low {
            background: #c6f6d5;
            color: #276749;
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .refresh-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
            margin-top: 20px;
        }

        .refresh-button:hover {
            background: #5a67d8;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Personal Learning Analytics</h1>
            <p>Understand your learning patterns and optimize your HSC preparation</p>
        </div>

        <div class="dashboard-grid">
            <!-- Learning Style Analysis -->
            <div class="card">
                <h2><span class="card-icon">üéØ</span>Learning Style</h2>
                <div id="learning-style-content" class="loading">
                    <div class="spinner"></div>
                    Analyzing your learning preferences...
                </div>
            </div>

            <!-- Study Effectiveness -->
            <div class="card">
                <h2><span class="card-icon">‚ö°</span>Study Effectiveness</h2>
                <div id="study-effectiveness-content" class="loading">
                    <div class="spinner"></div>
                    Calculating effectiveness metrics...
                </div>
            </div>

            <!-- Knowledge Gaps -->
            <div class="card">
                <h2><span class="card-icon">üéØ</span>Knowledge Gaps</h2>
                <div id="knowledge-gaps-content" class="loading">
                    <div class="spinner"></div>
                    Identifying areas for improvement...
                </div>
            </div>

            <!-- Goal Progress -->
            <div class="card">
                <h2><span class="card-icon">üèÜ</span>Goal Progress</h2>
                <div id="goal-progress-content" class="loading">
                    <div class="spinner"></div>
                    Loading goal analytics...
                </div>
            </div>

            <!-- Study Streaks -->
            <div class="card">
                <h2><span class="card-icon">üî•</span>Study Streaks</h2>
                <div id="streak-content" class="loading">
                    <div class="spinner"></div>
                    Analyzing streak patterns...
                </div>
            </div>

            <!-- Study Optimization -->
            <div class="card">
                <h2><span class="card-icon">üöÄ</span>Optimization</h2>
                <div id="optimization-content" class="loading">
                    <div class="spinner"></div>
                    Generating recommendations...
                </div>
            </div>
        </div>

        <!-- Personal Insights Summary -->
        <div class="card full-width">
            <h2><span class="card-icon">üí°</span>Personal Insights Summary</h2>
            <div id="insights-summary-content" class="loading">
                <div class="spinner"></div>
                Generating comprehensive insights...
            </div>
        </div>

        <button class="refresh-button" onclick="loadAllData()">üîÑ Refresh Analytics</button>
    </div>

    <script>
        // Mock user ID for demo
        const USER_ID = 'student_123';
        const API_BASE = '/api/analytics';

        // Utility function to make API calls
        async function apiCall(endpoint) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`);
                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error || 'API call failed');
                }

                return data.data;
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        // Load learning style analysis
        async function loadLearningStyle() {
            try {
                const data = await apiCall(`/learning-style/${USER_ID}`);
                const content = document.getElementById('learning-style-content');

                if (data.status === 'insufficient_data') {
                    content.innerHTML = `
                        <div class="insight-item">
                            <div class="insight-title">Building Your Learning Profile</div>
                            <div class="insight-description">${data.message}</div>
                        </div>
                        <div class="recommendation">
                            <div class="recommendation-title">Get Started</div>
                            <div class="recommendation-description">Complete more study sessions to unlock personalized learning insights</div>
                        </div>
                    `;
                    return;
                }

                const style = data.learningStyle;
                content.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Preferred Content Type</span>
                        <span class="metric-value">${style.contentPreferences.primary}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Optimal Session Length</span>
                        <span class="metric-value">${style.optimalSessionLength.optimal} minutes</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Peak Performance Time</span>
                        <span class="metric-value">${style.peakPerformanceTimes.analysis[style.peakPerformanceTimes.peak].label}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Analysis Confidence</span>
                        <span class="metric-value">${data.confidence}</span>
                    </div>
                `;
            } catch (error) {
                document.getElementById('learning-style-content').innerHTML =
                    `<div class="error">Error loading learning style: ${error.message}</div>`;
            }
        }

        // Load study effectiveness
        async function loadStudyEffectiveness() {
            try {
                const data = await apiCall(`/study-effectiveness/${USER_ID}`);
                const content = document.getElementById('study-effectiveness-content');

                if (data.status === 'insufficient_data') {
                    content.innerHTML = `
                        <div class="insight-item">
                            <div class="insight-title">Building Effectiveness Profile</div>
                            <div class="insight-description">${data.message}</div>
                        </div>
                    `;
                    return;
                }

                const effectiveness = data.effectiveness;
                content.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Overall Score</span>
                        <span class="metric-value">${data.overallScore}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${data.overallScore}%"></div>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Learning Efficiency</span>
                        <span class="metric-value">${effectiveness.learningEfficiency.benchmarkComparison}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Questions/Minute</span>
                        <span class="metric-value">${effectiveness.learningEfficiency.questionsCorrectPerMinute.toFixed(2)}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Trend</span>
                        <span class="metric-value">${data.trends.trend}</span>
                    </div>
                `;
            } catch (error) {
                document.getElementById('study-effectiveness-content').innerHTML =
                    `<div class="error">Error loading effectiveness: ${error.message}</div>`;
            }
        }

        // Load knowledge gaps
        async function loadKnowledgeGaps() {
            try {
                const data = await apiCall(`/knowledge-gaps/${USER_ID}`);
                const content = document.getElementById('knowledge-gaps-content');

                if (data.status === 'insufficient_data') {
                    content.innerHTML = `
                        <div class="insight-item">
                            <div class="insight-title">Building Knowledge Profile</div>
                            <div class="insight-description">${data.message}</div>
                        </div>
                    `;
                    return;
                }

                const gaps = data.gapAnalysis.criticalGaps.slice(0, 3);
                let gapsHtml = '';

                gaps.forEach(gap => {
                    gapsHtml += `
                        <div class="insight-item">
                            <div class="insight-title">${gap.topicName}</div>
                            <div class="insight-description">
                                Current: ${gap.currentScore}% | Target: ${gap.targetScore}%
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${gap.currentScore}%"></div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                content.innerHTML = gapsHtml || '<div class="insight-item"><div class="insight-title">Great Progress!</div><div class="insight-description">No critical knowledge gaps identified</div></div>';
            } catch (error) {
                document.getElementById('knowledge-gaps-content').innerHTML =
                    `<div class="error">Error loading knowledge gaps: ${error.message}</div>`;
            }
        }

        // Load goal progress
        async function loadGoalProgress() {
            try {
                const data = await apiCall(`/goal-progress/${USER_ID}`);
                const content = document.getElementById('goal-progress-content');

                const overview = data.overview;
                content.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Active Goals</span>
                        <span class="metric-value">${overview.activeGoals}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Completed Goals</span>
                        <span class="metric-value">${overview.completedGoals}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Average Progress</span>
                        <span class="metric-value">${overview.averageProgress.toFixed(1)}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${overview.averageProgress}%"></div>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Achievement Points</span>
                        <span class="metric-value">${data.achievements.totalPoints}</span>
                    </div>
                `;
            } catch (error) {
                document.getElementById('goal-progress-content').innerHTML =
                    `<div class="error">Error loading goal progress: ${error.message}</div>`;
            }
        }

        // Load streak analysis
        async function loadStreakAnalysis() {
            try {
                const data = await apiCall(`/streak-patterns/${USER_ID}`);
                const content = document.getElementById('streak-content');

                if (data.status === 'insufficient_data') {
                    content.innerHTML = `
                        <div class="insight-item">
                            <div class="insight-title">Start Your Streak</div>
                            <div class="insight-description">${data.message}</div>
                        </div>
                    `;
                    return;
                }

                const currentStreak = data.currentStreak;
                const history = data.streakHistory;

                content.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Current Streak</span>
                        <span class="metric-value">${currentStreak.length} days</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Streak Quality</span>
                        <span class="metric-value">${currentStreak.quality}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Longest Streak</span>
                        <span class="metric-value">${history.longestStreak.length} days</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Break Risk</span>
                        <span class="metric-value priority-${data.predictions.breakRisk.level.replace('_risk', '')}">${data.predictions.breakRisk.level.replace('_', ' ')}</span>
                    </div>
                `;
            } catch (error) {
                document.getElementById('streak-content').innerHTML =
                    `<div class="error">Error loading streak analysis: ${error.message}</div>`;
            }
        }

        // Load optimization recommendations
        async function loadOptimization() {
            try {
                const data = await apiCall(`/study-optimization/${USER_ID}`);
                const content = document.getElementById('optimization-content');

                const schedule = data.studySchedule;
                content.innerHTML = `
                    <div class="insight-item">
                        <div class="insight-title">Optimal Study Time</div>
                        <div class="insight-description">${schedule.daily.optimalTime}</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-title">Session Length</div>
                        <div class="insight-description">${schedule.daily.sessionLength}</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-title">Weekly Target</div>
                        <div class="insight-description">${schedule.weekly.totalHours} hours total</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-title">Break Pattern</div>
                        <div class="insight-description">${schedule.daily.breakFrequency}</div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('optimization-content').innerHTML =
                    `<div class="error">Error loading optimization: ${error.message}</div>`;
            }
        }

        // Load comprehensive insights summary
        async function loadInsightsSummary() {
            try {
                const data = await apiCall(`/personal-insights/${USER_ID}`);
                const content = document.getElementById('insights-summary-content');

                const summary = data.summary;

                let summaryHtml = '<div class="two-column">';

                // Top Priorities
                summaryHtml += '<div>';
                summaryHtml += '<h3 style="margin-bottom: 15px; color: #2d3748;">üéØ Top Priorities</h3>';
                if (summary.topPriorities.length > 0) {
                    summary.topPriorities.forEach(priority => {
                        summaryHtml += `<div class="recommendation high"><div class="recommendation-title">${priority}</div></div>`;
                    });
                } else {
                    summaryHtml += '<div class="insight-item"><div class="insight-description">Great work! No critical priorities identified.</div></div>';
                }
                summaryHtml += '</div>';

                // Key Strengths
                summaryHtml += '<div>';
                summaryHtml += '<h3 style="margin-bottom: 15px; color: #2d3748;">üí™ Key Strengths</h3>';
                if (summary.keyStrengths.length > 0) {
                    summary.keyStrengths.forEach(strength => {
                        summaryHtml += `<div class="recommendation low"><div class="recommendation-title">${strength}</div></div>`;
                    });
                } else {
                    summaryHtml += '<div class="insight-item"><div class="insight-description">Building your strength profile...</div></div>';
                }
                summaryHtml += '</div>';

                summaryHtml += '</div>';

                // Immediate Actions
                if (summary.immediateActions.length > 0) {
                    summaryHtml += '<h3 style="margin: 20px 0 15px 0; color: #2d3748;">‚ö° Immediate Actions</h3>';
                    summary.immediateActions.forEach(action => {
                        summaryHtml += `<div class="recommendation medium"><div class="recommendation-title">${action}</div></div>`;
                    });
                }

                // Weekly Focus
                if (summary.weeklyFocus.length > 0) {
                    summaryHtml += '<h3 style="margin: 20px 0 15px 0; color: #2d3748;">üìÖ This Week\'s Focus</h3>';
                    summary.weeklyFocus.forEach(focus => {
                        summaryHtml += `<div class="insight-item"><div class="insight-description">${focus}</div></div>`;
                    });
                }

                content.innerHTML = summaryHtml;
            } catch (error) {
                document.getElementById('insights-summary-content').innerHTML =
                    `<div class="error">Error loading insights summary: ${error.message}</div>`;
            }
        }

        // Load all dashboard data
        async function loadAllData() {
            const loadingElements = document.querySelectorAll('.loading');
            loadingElements.forEach(el => {
                el.innerHTML = '<div class="spinner"></div>Loading...';
            });

            // Load all components in parallel
            await Promise.all([
                loadLearningStyle(),
                loadStudyEffectiveness(),
                loadKnowledgeGaps(),
                loadGoalProgress(),
                loadStreakAnalysis(),
                loadOptimization(),
                loadInsightsSummary()
            ]);
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            loadAllData();
        });
    </script>
</body>
</html>